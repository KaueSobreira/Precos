{% extends 'base.html' %}

{% block title %}{% if object %}Editar{% else %}Novo{% endif %} Produto{% endblock %}
{% block page_title %}{% if object %}Editar{% else %}Novo{% endif %} Produto{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">{% if object %}Editar Produto: {{ object.sku }}{% else %}Cadastrar Novo Produto{% endif %}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            {% if form.errors %}
            <div class="alert alert-danger">
                <ul class="mb-0">
                    {% for field in form %}
                        {% for error in field.errors %}
                        <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label for="id_titulo" class="form-label">Título Principal *</label>
                        <input type="text" name="titulo" class="form-control" id="id_titulo"
                               value="{% if object %}{{ object.titulo }}{% else %}{{ form.titulo.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="id_ativo" class="form-label">Status</label>
                        <div class="form-check form-switch mt-2">
                            <input type="checkbox" name="ativo" class="form-check-input" id="id_ativo"
                                   {% if object %}{% if object.ativo %}checked{% endif %}{% else %}checked{% endif %}>
                            <label class="form-check-label" for="id_ativo">Ativo</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="id_sku" class="form-label">SKU *</label>
                        <input type="text" name="sku" class="form-control" id="id_sku"
                               value="{% if object %}{{ object.sku }}{% else %}{{ form.sku.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="id_ean" class="form-label">EAN</label>
                        <input type="text" name="ean" class="form-control" id="id_ean"
                               value="{% if object %}{{ object.ean }}{% else %}{{ form.ean.value|default:'' }}{% endif %}">
                    </div>
                </div>
            </div>

            <hr>
            <h6>Dimensões</h6>

            <div class="row">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="id_largura" class="form-label">Largura (cm) *</label>
                        <input type="number" step="0.01" name="largura" class="form-control" id="id_largura"
                               value="{% if object %}{{ object.largura }}{% else %}{{ form.largura.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="id_altura" class="form-label">Altura (cm) *</label>
                        <input type="number" step="0.01" name="altura" class="form-control" id="id_altura"
                               value="{% if object %}{{ object.altura }}{% else %}{{ form.altura.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="id_profundidade" class="form-label">Profundidade (cm) *</label>
                        <input type="number" step="0.01" name="profundidade" class="form-control" id="id_profundidade"
                               value="{% if object %}{{ object.profundidade }}{% else %}{{ form.profundidade.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="id_peso_fisico" class="form-label">Peso Físico (kg) *</label>
                        <input type="number" step="0.001" name="peso_fisico" class="form-control" id="id_peso_fisico"
                               value="{% if object %}{{ object.peso_fisico }}{% else %}{{ form.peso_fisico.value|default:'' }}{% endif %}" required>
                    </div>
                </div>
            </div>

            {% if object %}
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="card bg-light">
                        <div class="card-body py-2">
                            <small class="text-muted">
                                <strong>Peso Cúbico:</strong> {{ object.peso_cubico|floatformat:3 }} kg |
                                <strong>Peso Produto (Frete):</strong> {{ object.peso_produto|floatformat:3 }} kg
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-lg"></i> Salvar
                </button>
                {% if object %}
                <a href="{% url 'ficha_tecnica_edit' object.pk %}" class="btn btn-outline-success">
                    <i class="bi bi-list-check"></i> Ficha Técnica
                </a>
                <a href="{% url 'produto_detail' object.pk %}" class="btn btn-outline-secondary">Cancelar</a>
                {% else %}
                <a href="{% url 'produto_list' %}" class="btn btn-outline-secondary">Cancelar</a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endblock %}
